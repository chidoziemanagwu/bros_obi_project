{% extends "base.html" %}
{% block title %}Staff Dashboard{% endblock %}
{% load humanize %}

{% block content %}
<div class="mt-6 sm:mt-8">
  <div class="rounded-2xl bg-white/60 p-5 sm:p-6 md:p-8 shadow-lg ring-1 ring-slate-100">
    <!-- Header -->
    <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 sm:gap-4 mb-6 md:mb-8">
      <div class="min-w-0">
        <h1 class="text-2xl md:text-3xl font-bold flex items-center text-slate-800">
          <i data-feather="user" class="mr-3 w-7 h-7 md:w-8 md:h-8 text-blue-600"></i>
          <span class="truncate">Staff Dashboard</span>
        </h1>
        <p class="mt-1 text-sm text-slate-500">
          Welcome, <span class="font-medium text-slate-700">{{ request.user.get_full_name|default:request.user.username }}</span>
        </p>
      </div>
      <div class="grid grid-cols-2 gap-2 sm:flex sm:items-center">
        <a href="{% url 'sale_create' %}" class="inline-flex items-center justify-center gap-2 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg transition shadow-sm w-full sm:w-auto">
          <i data-feather="shopping-cart" class="w-4 h-4"></i>
          <span>New Sale</span>
        </a>
        <a href="{% url 'price_list' %}" class="inline-flex items-center justify-center gap-2 bg-slate-700 hover:bg-slate-800 text-white px-4 py-2 rounded-lg transition shadow-sm w-full sm:w-auto">
          <i data-feather="printer" class="w-4 h-4"></i>
          <span>Print Price List</span>
        </a>
      </div>
    </div>

    <!-- Quick Stats -->
    <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4 md:gap-5 mb-8 md:mb-10">
      <div class="rounded-xl bg-white/80 p-5 md:p-6 shadow-sm ring-1 ring-slate-100">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-slate-500">Today's Sales</h3>
          <i data-feather="trending-up" class="w-5 h-5 text-emerald-600"></i>
        </div>
        <p class="mt-2 text-2xl md:text-3xl font-bold text-slate-900">₦{{ today_total_amount|floatformat:2|intcomma }}</p>
      </div>

      <div class="rounded-xl bg-white/80 p-5 md:p-6 shadow-sm ring-1 ring-slate-100">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-slate-500">Items Sold</h3>
          <i data-feather="package" class="w-5 h-5 text-blue-600"></i>
        </div>
        <p class="mt-2 text-2xl md:text-3xl font-bold text-slate-900">{{ today_total_items|default:0|intcomma }}</p>
      </div>

      <div class="rounded-xl bg-white/80 p-5 md:p-6 shadow-sm ring-1 ring-slate-100">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-slate-500">Last Sale</h3>
          <i data-feather="clock" class="w-5 h-5 text-amber-600"></i>
        </div>
        {% if last_sale %}
          <p class="mt-2 text-sm text-slate-700">
            {{ last_sale.created_at|date:"Y-m-d H:i" }} — <span class="font-medium">{{ last_sale.product.name }}</span>
            <span class="text-slate-500">x{{ last_sale.quantity|intcomma }}</span>
            <span class="font-semibold text-slate-900 block sm:inline">(₦{{ last_sale.total_price|floatformat:2|intcomma }})</span>
          </p>
        {% else %}
          <p class="mt-2 text-sm text-slate-500">No sales yet</p>
        {% endif %}
      </div>

      <div class="rounded-xl bg-white/80 p-5 md:p-6 shadow-sm ring-1 ring-slate-100">
        <div class="flex items-center justify-between">
          <h3 class="text-sm font-medium text-slate-500">This Month</h3>
          <i data-feather="target" class="w-5 h-5 text-indigo-600"></i>
        </div>
        <p class="mt-2 text-2xl md:text-3xl font-bold text-slate-900">₦{{ month_total_amount|floatformat:2|intcomma }}</p>
      </div>
    </div>

    <!-- Quick Actions -->
    <div class="rounded-2xl bg-white/80 p-5 md:p-6 shadow-sm ring-1 ring-slate-100 mb-8 md:mb-10">
      <h3 class="text-base md:text-lg font-semibold text-slate-800 mb-4 flex items-center">
        <i data-feather="zap" class="mr-2 w-5 h-5 text-amber-600"></i>
        Quick Actions
      </h3>
      <div class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-3 md:gap-4">
        <a href="{% url 'sale_create' %}" class="p-4 bg-white rounded-xl border border-slate-100 hover:border-blue-200 hover:shadow-md transition text-center">
          <i data-feather="plus-circle" class="mx-auto mb-2 w-6 h-6 text-emerald-600"></i>
          <p class="text-sm font-medium text-slate-700">New Sale</p>
        </a>
        <a href="{% url 'products_list' %}" class="p-4 bg-white rounded-xl border border-slate-100 hover:border-blue-200 hover:shadow-md transition text-center">
          <i data-feather="list" class="mx-auto mb-2 w-6 h-6 text-blue-600"></i>
          <p class="text-sm font-medium text-slate-700">View Products</p>
        </a>
        <a href="{% url 'price_list' %}" class="p-4 bg-white rounded-xl border border-slate-100 hover:border-blue-200 hover:shadow-md transition text-center">
          <i data-feather="printer" class="mx-auto mb-2 w-6 h-6 text-indigo-600"></i>
          <p class="text-sm font-medium text-slate-700">Print List</p>
        </a>
        <!-- Change Password only (replaces generic Settings) -->
        <a href="{% url 'staff_password_change' %}" class="p-4 bg-white rounded-xl border border-slate-100 hover:border-amber-200 hover:shadow-md transition text-center">
          <i data-feather="lock" class="mx-auto mb-2 w-6 h-6 text-amber-600"></i>
          <p class="text-sm font-medium text-slate-700">Change Password</p>
        </a>
      </div>
      {# Optional: if you have a reset-by-email flow configured, you can add: #}
      {# <p class="mt-3 text-xs text-slate-500">Forgot your current password? <a href="{% url 'password_reset' %}" class="text-blue-600 hover:text-blue-700">Reset it here</a>.</p> #}
    </div>

    <!-- Recent Activity -->
    <div class="rounded-2xl bg-white/80 p-5 md:p-6 shadow-sm ring-1 ring-slate-100">
      <h3 class="text-base md:text-lg font-semibold text-slate-800 mb-4 flex items-center">
        <i data-feather="activity" class="mr-2 w-5 h-5 text-blue-600"></i>
        Recent Activity
      </h3>
      <div class="space-y-3">
        {% if recent_sales %}
          {% for s in recent_sales %}
            <div class="flex items-start sm:items-center p-3 bg-white rounded-xl border border-slate-100 hover:bg-slate-50 transition">
              <div class="w-9 h-9 bg-emerald-500 rounded-full flex items-center justify-center mr-3 shadow-sm flex-shrink-0">
                <i data-feather="check" class="w-4 h-4 text-white"></i>
              </div>
              <div class="text-sm min-w-0">
                <p class="font-medium text-slate-800">
                  <span class="whitespace-nowrap">{{ s.created_at|date:"Y-m-d H:i" }}</span>
                  <span class="text-slate-400 px-1">—</span>
                  <span class="truncate inline-block max-w-full align-bottom">{{ s.product.name }}</span>
                  <span class="text-slate-500">x{{ s.quantity|intcomma }}</span>
                  <span class="text-slate-400">for</span>
                  <span class="font-semibold text-slate-900">₦{{ s.total_price|floatformat:2|intcomma }}</span>
                </p>
                <p class="text-xs text-slate-500">Sold by {{ s.sold_by.username }}</p>
              </div>
            </div>
          {% endfor %}
        {% else %}
          <div class="flex items-center p-4 bg-white rounded-xl border border-slate-100">
            <div class="w-9 h-9 bg-slate-300 rounded-full flex items-center justify-center mr-3">
              <i data-feather="inbox" class="w-4 h-4 text-white"></i>
            </div>
            <div>
              <p class="text-sm font-medium text-slate-700">No recent activity</p>
              <p class="text-xs text-slate-500">Start making sales to see activity here</p>
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
  document.addEventListener('DOMContentLoaded', () => {
    feather.replace();
  });
</script>
{% endblock %}